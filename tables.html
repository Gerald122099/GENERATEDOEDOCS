<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Information System</title>
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="//cdn.datatables.net/2.2.2/css/dataTables.dataTables.min.css">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .details-row {
            background-color: #f9f9f9;
        }
        .details-table {
            width: 100%;
        }
        .action-buttons {
            white-space: nowrap;
        }
        .tab-content {
            max-height: 500px;
            overflow-y: auto;
        }
        .form-section {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .form-section h5 {
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
    /* Add to your existing style section */
#pdfFrame {
    width: 100%;
    min-height: 500px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.pdf-view-btn {
    margin-right: 5px;
}

#pdfViewerContainer {
        width: 100%;
        height: 80vh;
        overflow: auto;
    }
    .pdf-page {
        margin-bottom: 20px;
        box-shadow: 0 0 5px rgba(0,0,0,0.3);
    }

/* For Bootstrap Icons (if using) */
@import url("https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css");
    </style>

      <!-- PDF.js Library -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
        <!-- jQuery -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <!-- DataTables JS -->
        <script src="//cdn.datatables.net/2.2.2/js/dataTables.min.js"></script>
        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="container mt-4">
        <h2>Business Information</h2>
        <table id="businessTable" class="table table-striped table-bordered" style="width:100%">
            <thead>
                <tr>
                    <th></th>
                    <th>ITR Form Number</th>
                    <th>Business Name</th>
                    <th>Dealer/Operator</th>
                    <th>Location</th>
                    <th>Outlet Class</th>
                    <th>Company</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data will be loaded via AJAX -->
            </tbody>
        </table>
    </div>

    <!-- Modal for View/Edit -->
    <div class="modal fade" id="businessModal" tabindex="-1" aria-labelledby="businessModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="businessModalLabel">Business Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="businessForm">
                        <input type="hidden" id="itr_form_num" name="itr_form_num">
                        
                        <!-- Tab navigation -->
                        <ul class="nav nav-tabs" id="businessTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic" type="button" role="tab">Basic Info</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="compliance-tab" data-bs-toggle="tab" data-bs-target="#compliance" type="button" role="tab">Compliance Checklist</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab">General Remarks</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="products-tab" data-bs-toggle="tab" data-bs-target="#products" type="button" role="tab">Product Quality</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="suppliers-tab" data-bs-toggle="tab" data-bs-target="#suppliers" type="button" role="tab">Suppliers</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="summary-tab" data-bs-toggle="tab" data-bs-target="#summary" type="button" role="tab">Summary Remarks</button>
                            </li>
                        </ul>
                        
                        <!-- Tab content -->
                        <div class="tab-content p-3 border border-top-0 rounded-bottom" id="businessTabContent">
                            <!-- Basic Information Tab -->
                            <div class="tab-pane fade show active" id="basic" role="tabpanel">
                                <div class="form-section">
                                    <h5>Business Information</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="business_name" class="form-label">Business Name</label>
                                                <input type="text" class="form-control" id="business_name" name="business_name">
                                            </div>
                                            <div class="mb-3">
                                                <label for="dealer_operator" class="form-label">Dealer/Operator</label>
                                                <input type="text" class="form-control" id="dealer_operator" name="dealer_operator">
                                            </div>
                                            <div class="mb-3">
                                                <label for="location" class="form-label">Location</label>
                                                <input type="text" class="form-control" id="location" name="location">
                                            </div>
                                            <div class="mb-3">
                                                <label for="in_charge" class="form-label">In Charge</label>
                                                <input type="text" class="form-control" id="in_charge" name="in_charge">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="designation" class="form-label">Designation</label>
                                                <input type="text" class="form-control" id="designation" name="designation">
                                            </div>
                                            <div class="mb-3">
                                                <label for="outlet_class" class="form-label">Outlet Class</label>
                                                <select class="form-select" id="outlet_class" name="outlet_class">
                                                    <option value="COCO">COCO</option>
                                                    <option value="CODO">CODO</option>
                                                    <option value="DODO">DODO</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label for="company" class="form-label">Company</label>
                                                <input type="text" class="form-control" id="company" name="company">
                                            </div>
                                            <div class="mb-3">
                                                <label for="inspector_name" class="form-label">Inspector Name</label>
                                                <input type="text" class="form-control" id="inspector_name" name="inspector_name">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h5>Contact Information</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="contact_tel" class="form-label">Contact Telephone</label>
                                                <input type="text" class="form-control" id="contact_tel" name="contact_tel">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="email_add" class="form-label">Email Address</label>
                                                <input type="email" class="form-control" id="email_add" name="email_add">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h5>Service Agreement</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="sa_no" class="form-label">SA Number</label>
                                                <input type="text" class="form-control" id="sa_no" name="sa_no">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="sa_date" class="form-label">SA Date</label>
                                                <input type="date" class="form-control" id="sa_date" name="sa_date">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h5>Other Information</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" id="sampling" name="sampling">
                                                <label class="form-check-label" for="sampling">Sampling</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Compliance Checklist Tab -->
                            <div class="tab-pane fade" id="compliance" role="tabpanel">
                                <div class="form-section">
                                    <h5>Certificates and Permits</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="coc_cert" name="coc_cert">
                                                <label class="form-check-label" for="coc_cert">COC Certificate</label>
                                                <input type="text" class="form-control mt-1" id="coc_cert_remarks" name="coc_cert_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="coc_posted" name="coc_posted">
                                                <label class="form-check-label" for="coc_posted">COC Posted</label>
                                                <input type="text" class="form-control mt-1" id="coc_posted_remarks" name="coc_posted_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="valid_permit_LGU" name="valid_permit_LGU">
                                                <label class="form-check-label" for="valid_permit_LGU">Valid Permit (LGU)</label>
                                                <input type="text" class="form-control mt-1" id="valid_permit_LGU_remarks" name="valid_permit_LGU_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="valid_permit_BFP" name="valid_permit_BFP">
                                                <label class="form-check-label" for="valid_permit_BFP">Valid Permit (BFP)</label>
                                                <input type="text" class="form-control mt-1" id="valid_permit_BFP_remarks" name="valid_permit_BFP_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="valid_permit_DENR" name="valid_permit_DENR">
                                                <label class="form-check-label" for="valid_permit_DENR">Valid Permit (DENR)</label>
                                                <input type="text" class="form-control mt-1" id="valid_permit_DENR_remarks" name="valid_permit_DENR_remarks" placeholder="Remarks">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="appropriate_test" name="appropriate_test">
                                                <label class="form-check-label" for="appropriate_test">Appropriate Test</label>
                                                <input type="text" class="form-control mt-1" id="appropriate_test_remarks" name="appropriate_test_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="week_calib" name="week_calib">
                                                <label class="form-check-label" for="week_calib">Weekly Calibration</label>
                                                <input type="text" class="form-control mt-1" id="week_calib_remarks" name="week_calib_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="outlet_identify" name="outlet_identify">
                                                <label class="form-check-label" for="outlet_identify">Outlet Identification</label>
                                                <input type="text" class="form-control mt-1" id="outlet_identify_remarks" name="outlet_identify_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="price_display" name="price_display">
                                                <label class="form-check-label" for="price_display">Price Display</label>
                                                <input type="text" class="form-control mt-1" id="price_display_remarks" name="price_display_remarks" placeholder="Remarks">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h5>PDB Information</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="pdb_entry" name="pdb_entry">
                                                <label class="form-check-label" for="pdb_entry">PDB Entry</label>
                                                <input type="text" class="form-control mt-1" id="pdb_entry_remarks" name="pdb_entry_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="pdb_updated" name="pdb_updated">
                                                <label class="form-check-label" for="pdb_updated">PDB Updated</label>
                                                <input type="text" class="form-control mt-1" id="pdb_updated_remarks" name="pdb_updated_remarks" placeholder="Remarks">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="pdb_match" name="pdb_match">
                                                <label class="form-check-label" for="pdb_match">PDB Match</label>
                                                <input type="text" class="form-control mt-1" id="pdb_match_remarks" name="pdb_match_remarks" placeholder="Remarks">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h5>Labels and Signage</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="ron_label" name="ron_label">
                                                <label class="form-check-label" for="ron_label">RON Label</label>
                                                <input type="text" class="form-control mt-1" id="ron_label_remarks" name="ron_label_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="e10_label" name="e10_label">
                                                <label class="form-check-label" for="e10_label">E10 Label</label>
                                                <input type="text" class="form-control mt-1" id="e10_label_remarks" name="e10_label_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="biofuels" name="biofuels">
                                                <label class="form-check-label" for="biofuels">Biofuels</label>
                                                <input type="text" class="form-control mt-1" id="biofuels_remarks" name="biofuels_remarks" placeholder="Remarks">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="consume_safety" name="consume_safety">
                                                <label class="form-check-label" for="consume_safety">Consumer Safety</label>
                                                <input type="text" class="form-control mt-1" id="consume_safety_remarks" name="consume_safety_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="cel_warn" name="cel_warn">
                                                <label class="form-check-label" for="cel_warn">CEL Warning</label>
                                                <input type="text" class="form-control mt-1" id="cel_warn_remarks" name="cel_warn_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="smoke_sign" name="smoke_sign">
                                                <label class="form-check-label" for="smoke_sign">No Smoking Sign</label>
                                                <input type="text" class="form-control mt-1" id="smoke_sign_remarks" name="smoke_sign_remarks" placeholder="Remarks">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h5>Operational Standards</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="switch_eng" name="switch_eng">
                                                <label class="form-check-label" for="switch_eng">Switch Off Engine</label>
                                                <input type="text" class="form-control mt-1" id="switch_eng_remarks" name="switch_eng_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="straddle" name="straddle">
                                                <label class="form-check-label" for="straddle">Straddle</label>
                                                <input type="text" class="form-control mt-1" id="straddle_remarks" name="straddle_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="post_unleaded" name="post_unleaded">
                                                <label class="form-check-label" for="post_unleaded">Post Unleaded</label>
                                                <input type="text" class="form-control mt-1" id="post_unleaded_remarks" name="post_unleaded_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="post_biodiesel" name="post_biodiesel">
                                                <label class="form-check-label" for="post_biodiesel">Post Biodiesel</label>
                                                <input type="text" class="form-control mt-1" id="post_biodiesel_remarks" name="post_biodiesel_remarks" placeholder="Remarks">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="issue_receipt" name="issue_receipt">
                                                <label class="form-check-label" for="issue_receipt">Issue Receipt</label>
                                                <input type="text" class="form-control mt-1" id="issue_receipt_remarks" name="issue_receipt_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="non_refuse_inspect" name="non_refuse_inspect">
                                                <label class="form-check-label" for="non_refuse_inspect">Non-Refuse Inspection</label>
                                                <input type="text" class="form-control mt-1" id="non_refuse_inspect_remarks" name="non_refuse_inspect_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="non_refuse_sign" name="non_refuse_sign">
                                                <label class="form-check-label" for="non_refuse_sign">Non-Refuse Sign</label>
                                                <input type="text" class="form-control mt-1" id="non_refuse_sign_remarks" name="non_refuse_sign_remarks" placeholder="Remarks">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h5>Safety Measures</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="fixed_dispense" name="fixed_dispense">
                                                <label class="form-check-label" for="fixed_dispense">Fixed Dispense</label>
                                                <input type="text" class="form-control mt-1" id="fixed_dispense_remarks" name="fixed_dispense_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="no_open_flame" name="no_open_flame">
                                                <label class="form-check-label" for="no_open_flame">No Open Flame</label>
                                                <input type="text" class="form-control mt-1" id="no_open_flame_remarks" name="no_open_flame_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="max_length_dispense" name="max_length_dispense">
                                                <label class="form-check-label" for="max_length_dispense">Max Length Dispense</label>
                                                <input type="text" class="form-control mt-1" id="max_length_dispense_remarks" name="max_length_dispense_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="peso_display" name="peso_display">
                                                <label class="form-check-label" for="peso_display">Peso Display</label>
                                                <input type="text" class="form-control mt-1" id="peso_display_remarks" name="peso_display_remarks" placeholder="Remarks">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="pump_island" name="pump_island">
                                                <label class="form-check-label" for="pump_island">Pump Island</label>
                                                <input type="text" class="form-control mt-1" id="pump_island_remarks" name="pump_island_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="lane_oriented_pump" name="lane_oriented_pump">
                                                <label class="form-check-label" for="lane_oriented_pump">Lane Oriented Pump</label>
                                                <input type="text" class="form-control mt-1" id="lane_oriented_pump_remarks" name="lane_oriented_pump_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="pump_guard" name="pump_guard">
                                                <label class="form-check-label" for="pump_guard">Pump Guard</label>
                                                <input type="text" class="form-control mt-1" id="pump_guard_remarks" name="pump_guard_remarks" placeholder="Remarks">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h5>Facility Standards</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="m_ingress" name="m_ingress">
                                                <label class="form-check-label" for="m_ingress">Ingress</label>
                                                <input type="text" class="form-control mt-1" id="m_ingress_remarks" name="m_ingress_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="m_edge" name="m_edge">
                                                <label class="form-check-label" for="m_edge">Edge</label>
                                                <input type="text" class="form-control mt-1" id="m_edge_remarks" name="m_edge_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="office_cashier" name="office_cashier">
                                                <label class="form-check-label" for="office_cashier">Office/Cashier</label>
                                                <input type="text" class="form-control mt-1" id="office_cashier_remarks" name="office_cashier_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="min_canopy" name="min_canopy">
                                                <label class="form-check-label" for="min_canopy">Minimum Canopy</label>
                                                <input type="text" class="form-control mt-1" id="min_canopy_remarks" name="min_canopy_remarks" placeholder="Remarks">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="boundary_walls" name="boundary_walls">
                                                <label class="form-check-label" for="boundary_walls">Boundary Walls</label>
                                                <input type="text" class="form-control mt-1" id="boundary_walls_remarks" name="boundary_walls_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="master_switch" name="master_switch">
                                                <label class="form-check-label" for="master_switch">Master Switch</label>
                                                <input type="text" class="form-control mt-1" id="master_switch_remarks" name="master_switch_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="clean_rest" name="clean_rest">
                                                <label class="form-check-label" for="clean_rest">Clean Restroom</label>
                                                <input type="text" class="form-control mt-1" id="clean_rest_remarks" name="clean_rest_remarks" placeholder="Remarks">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h5>Storage and Equipment</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="underground_storage" name="underground_storage">
                                                <label class="form-check-label" for="underground_storage">Underground Storage</label>
                                                <input type="text" class="form-control mt-1" id="underground_storage_remarks" name="underground_storage_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="m_distance" name="m_distance">
                                                <label class="form-check-label" for="m_distance">Minimum Distance</label>
                                                <input type="text" class="form-control mt-1" id="m_distance_remarks" name="m_distance_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="vent" name="vent">
                                                <label class="form-check-label" for="vent">Vent</label>
                                                <input type="text" class="form-control mt-1" id="vent_remarks" name="vent_remarks" placeholder="Remarks">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="transfer_dispense" name="transfer_dispense">
                                                <label class="form-check-label" for="transfer_dispense">Transfer Dispense</label>
                                                <input type="text" class="form-control mt-1" id="transfer_dispense_remarks" name="transfer_dispense_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="no_drum" name="no_drum">
                                                <label class="form-check-label" for="no_drum">No Drum</label>
                                                <input type="text" class="form-control mt-1" id="no_drum_remarks" name="no_drum_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="no_hoard" name="no_hoard">
                                                <label class="form-check-label" for="no_hoard">No Hoard</label>
                                                <input type="text" class="form-control mt-1" id="no_hoard_remarks" name="no_hoard_remarks" placeholder="Remarks">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h5>Additional Services</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="free_tire_press" name="free_tire_press">
                                                <label class="form-check-label" for="free_tire_press">Free Tire Pressure</label>
                                                <input type="text" class="form-control mt-1" id="free_tire_press_remarks" name="free_tire_press_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="free_water" name="free_water">
                                                <label class="form-check-label" for="free_water">Free Water</label>
                                                <input type="text" class="form-control mt-1" id="free_water_remarks" name="free_water_remarks" placeholder="Remarks">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="basic_mechanical" name="basic_mechanical">
                                                <label class="form-check-label" for="basic_mechanical">Basic Mechanical</label>
                                                <input type="text" class="form-control mt-1" id="basic_mechanical_remarks" name="basic_mechanical_remarks" placeholder="Remarks">
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="first_aid" name="first_aid">
                                                <label class="form-check-label" for="first_aid">First Aid</label>
                                                <input type="text" class="form-control mt-1" id="first_aid_remarks" name="first_aid_remarks" placeholder="Remarks">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h5>Evaluations</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="design_eval" name="design_eval">
                                                <label class="form-check-label" for="design_eval">Design Evaluation</label>
                                                <input type="text" class="form-control mt-1" id="design_eval_remarks" name="design_eval_remarks" placeholder="Remarks">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="electric_eval" name="electric_eval">
                                                <label class="form-check-label" for="electric_eval">Electric Evaluation</label>
                                                <input type="text" class="form-control mt-1" id="electric_eval_remarks" name="electric_eval_remarks" placeholder="Remarks">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- General Remarks Tab -->
                            <div class="tab-pane fade" id="general" role="tabpanel">
                                <div class="mb-3">
                                    <label for="remarks" class="form-label">Remarks</label>
                                    <textarea class="form-control" id="remarks" name="remarks" rows="5"></textarea>
                                </div>
                            </div>
                            
                            <!-- Product Quality Tab -->
                            <div class="tab-pane fade" id="products" role="tabpanel">
                                <div id="productQualityContainer">
                                    <!-- Product cards will be dynamically inserted here -->
                                </div>
                                
                                <!-- Template for product cards (hidden) -->
                                <div class="card mb-3 product-card-template d-none">
                                    <div class="card-header">
                                        <h5 class="mb-0">Product <span class="product-index"></span></h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-4">
                                                <label class="form-label">Product</label>
                                                <input type="text" class="form-control product-field" data-field="product">
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">RON Value</label>
                                                <input type="text" class="form-control product-field" data-field="ron_value">
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">UGT</label>
                                                <input type="text" class="form-control product-field" data-field="UGT">
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Pump</label>
                                                <input type="text" class="form-control product-field" data-field="pump">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Code Value</label>
                                                <input type="text" class="form-control product-field" data-field="code_value">
                                            </div>
                                        </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="duplicate_retention_samples" name="duplicate_retention_samples">
                                            <label class="form-check-label" for="duplicate_retention_samples">Duplicate Retention Samples</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="retention_retail" name="retention_retail">
                                            <label class="form-check-label" for="retention_retail">Retention Retail</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="appropriate_sampling" name="appropriate_sampling">
                                            <label class="form-check-label" for="appropriate_sampling">Appropriate Sampling</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="inappropriate_sampling" name="inappropriate_sampling">
                                            <label class="form-check-label" for="inappropriate_sampling">Inappropriate Sampling</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                
                            
                            <!-- Suppliers Tab -->
                            <div class="tab-pane fade" id="suppliers" role="tabpanel">
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label for="supplier" class="form-label">Supplier</label>
                                        <input type="text" class="form-control" id="supplier" name="supplier">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="date_deliver" class="form-label">Date Delivered</label>
                                        <input type="date" class="form-control" id="date_deliver" name="date_deliver">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="contact_num" class="form-label">Contact Number</label>
                                        <input type="text" class="form-control" id="contact_num" name="contact_num">
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="receipt_invoice" class="form-label">Receipt/Invoice</label>
                                        <input type="text" class="form-control" id="receipt_invoice" name="receipt_invoice">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="address" class="form-label">Address</label>
                                    <textarea class="form-control" id="address" name="address" rows="2"></textarea>
                                </div>
                            </div>
                            
                         <!-- Summary Remarks Tab -->
                         <div class="tab-pane fade" id="summary" role="tabpanel">
                            <div class="mb-3">
                                <label for="extracted_violations" class="form-label">Extracted Violations</label>
                                <textarea type="text" class="form-control" id="extracted_violations" name="extracted_violations"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="extracted_gen_remarks" class="form-label">Extracted General Remarks</label>
                                <textarea type="text" class="form-control" id="extracted_gen_remarks" name="extracted_gen_remarks"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="user_violations" class="form-label">User Violations</label>
                                <textarea type="text" class="form-control" id="user_violations" name="user_violations"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="user_gen_remarks" class="form-label">User General Remarks</label>
                                <textarea type="text" class="form-control" id="user_gen_remarks" name="user_gen_remarks"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="action_required" class="form-label">Action Required</label>
                                <textarea type="text" class="form-control" id="action_required" name="action_required"></textarea>
                            </div>
                        </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveBusiness">Save changes</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this business record? This action cannot be undone.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDelete">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="pdfViewerModal" tabindex="-1" aria-labelledby="pdfViewerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="pdfViewerModalLabel">PDF Viewer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="pdfViewerContainer"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    



    <script>
    $(document).ready(function() {
        // Initialize DataTable
        let table = new DataTable('#businessTable', {
            ajax: {
                url: 'fetch_business.php',
                dataSrc: ''
            },
            columns: [
                {
                    className: 'dt-control',
                    orderable: false,
                    data: null,
                    defaultContent: '',
                    width: '20px'
                },
                { data: 'itr_form_num' },
                { data: 'business_name' },
                { data: 'dealer_operator' },
                { data: 'location' },
                { data: 'outlet_class' },
                { data: 'company' },
                {
                    data: null,
        className: 'action-buttons',
        render: function(data, type, row) {
            return `
                <a href="generate.php?id=${row.itr_form_num}" target="_blank" class="btn btn-sm btn-info pdf-view-btn" data-id="${row.itr_form_num}" title="View PDF">
                    <i class="bi bi-file-earmark-pdf"></i> View
                </a>
                <button class="btn btn-sm btn-warning edit-btn" data-id="${row.itr_form_num}">Edit</button>
                <button class="btn btn-sm btn-danger delete-btn" data-id="${row.itr_form_num}">Delete</button>
            `;
        },
        orderable: false
    }
],
            responsive: true
        });

        // Add event listener for opening and closing details
        $('#businessTable tbody').on('click', 'td.dt-control', function() {
            let tr = $(this).closest('tr');
            let row = table.row(tr);
            let itrFormNum = row.data().itr_form_num;

            if (row.child.isShown()) {
                // This row is already open - close it
                row.child.hide();
                tr.removeClass('details-row');
            } else {
                // Open this row
                showChildRow(row, itrFormNum);
                tr.addClass('details-row');
            }
        });

        // Function to show child row with related data
        function showChildRow(row, itrFormNum) {
            // Format the child row data
            let childRow = `
                <div class="details-container">
                    <div class="text-center my-2">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            `;

            // Display the row
            row.child(childRow).show();

            // Load the data via AJAX
            $.ajax({
                url: 'fetch_related_data.php',
                method: 'POST',
                data: { itr_form_num: itrFormNum },
                dataType: 'json',
                success: function(response) {
                    let content = `
                        <div class="details-container p-3">
                            <h5>Related Data for ${itrFormNum}</h5>
                            
                            <h6 class="mt-3">General Remarks</h6>
                            <table class="details-table table table-sm table-bordered">
                                <thead>
                                    <tr>
                                        <th>Remarks</th>
                                    </tr>
                                </thead>
                                <tbody>`;
                    
                    if (response.generalRemarks && response.generalRemarks.length > 0) {
                        response.generalRemarks.forEach(remark => {
                            content += `<tr><td>${remark.remarks || 'N/A'}</td></tr>`;
                        });
                    } else {
                        content += `<tr><td>No general remarks found</td></tr>`;
                    }
                    
                    content += `</tbody></table>
                            
                            <h6 class="mt-3">Product Quality</h6>
                            <table class="details-table table table-sm table-bordered">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>RON Value</th>
                                        <th>UGT</th>
                                        <th>Pump</th>
                                        <th>Code Value</th>
                                    </tr>
                                </thead>
                                <tbody>`;
                    
                    if (response.productQuality && response.productQuality.length > 0) {
                        response.productQuality.forEach(product => {
                            content += `
                                <tr>
                                    <td>${product.product || 'N/A'}</td>
                                    <td>${product.ron_value || 'N/A'}</td>
                                    <td>${product.UGT || 'N/A'}</td>
                                    <td>${product.pump || 'N/A'}</td>
                                    <td>${product.code_value || 'N/A'}</td>
                                </tr>`;
                        });
                    } else {
                        content += `<tr><td colspan="5">No product quality data found</td></tr>`;
                    }
                    
                    content += `</tbody></table>
                            
                            <h6 class="mt-3">Product Quality Control</h6>
                            <table class="details-table table table-sm table-bordered">
                                <thead>
                                    <tr>
                                        <th>Duplicate Retention Samples</th>
                                        <th>Retention Retail</th>
                                        <th>Appropriate Sampling</th>
                                        <th>Inappropriate Sampling</th>
                                    </tr>
                                </thead>
                                <tbody>`;
                    
                    if (response.productQualityCont && response.productQualityCont.length > 0) {
                        const pqc = response.productQualityCont[0];
                        content += `
                            <tr>
                                <td>${pqc.duplicate_retention_samples ? 'Yes' : 'No'}</td>
                                <td>${pqc.retention_retail ? 'Yes' : 'No'}</td>
                                <td>${pqc.appropriate_sampling ? 'Yes' : 'No'}</td>
                                <td>${pqc.inappropriate_sampling ? 'Yes' : 'No'}</td>
                            </tr>`;
                    } else {
                        content += `<tr><td colspan="4">No product quality control data found</td></tr>`;
                    }
                    
                    content += `</tbody></table>
                            
                            <h6 class="mt-3">Standard Compliance Checklist</h6>
                            <div class="table-responsive">
                                <table class="details-table table table-sm table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Check Item</th>
                                            <th>Compliant</th>
                                            <th>Remarks</th>
                                        </tr>
                                    </thead>
                                    <tbody>`;
                    
                    if (response.standardCompliance && response.standardCompliance.length > 0) {
                        const sc = response.standardCompliance[0];
                        // Add all compliance checklist items\
                        
                        content += `
                            <tr><td>COC Certificate</td><td>${sc.coc_cert ? 'Yes' : 'No'}</td><td>${sc.coc_cert_remarks || 'N/A'}</td></tr>
                            <tr><td>COC Posted</td><td>${sc.coc_posted ? 'Yes' : 'No'}</td><td>${sc.coc_posted_remarks || 'N/A'}</td></tr>
                            <tr><td>Valid Permit (LGU)</td><td>${sc.valid_permit_LGU ? 'Yes' : 'No'}</td><td>${sc.valid_permit_LGU_remarks || 'N/A'}</td></tr>
                            <tr><td>Valid Permit (BFP)</td><td>${sc.valid_permit_BFP ? 'Yes' : 'No'}</td><td>${sc.valid_permit_BFP_remarks || 'N/A'}</td></tr>
                            <tr><td>Valid Permit (DENR)</td><td>${sc.valid_permit_DENR ? 'Yes' : 'No'}</td><td>${sc.valid_permit_DENR_remarks || 'N/A'}</td></tr>
                            <tr><td>Appropriate Test</td><td>${sc.appropriate_test ? 'Yes' : 'No'}</td><td>${sc.appropriate_test_remarks || 'N/A'}</td></tr>
                            <tr><td>Weekly Calibration</td><td>${sc.week_calib ? 'Yes' : 'No'}</td><td>${sc.week_calib_remarks || 'N/A'}</td></tr>
                            <tr><td>Outlet Identification</td><td>${sc.outlet_identify ? 'Yes' : 'No'}</td><td>${sc.outlet_identify_remarks || 'N/A'}</td></tr>
                            <tr><td>Price Display</td><td>${sc.price_display ? 'Yes' : 'No'}</td><td>${sc.price_display_remarks || 'N/A'}</td></tr>
                            <tr><td>PDB Entry</td><td>${sc.pdb_entry ? 'Yes' : 'No'}</td><td>${sc.pdb_entry_remarks || 'N/A'}</td></tr>
                            <tr><td>PDB Updated</td><td>${sc.pdb_updated ? 'Yes' : 'No'}</td><td>${sc.pdb_updated_remarks || 'N/A'}</td></tr>
                            <tr><td>PDB Match</td><td>${sc.pdb_match ? 'Yes' : 'No'}</td><td>${sc.pdb_match_remarks || 'N/A'}</td></tr>
                            <tr><td>RON Label</td><td>${sc.ron_label ? 'Yes' : 'No'}</td><td>${sc.ron_label_remarks || 'N/A'}</td></tr>
                            <tr><td>E10 Label</td><td>${sc.e10_label ? 'Yes' : 'No'}</td><td>${sc.e10_label_remarks || 'N/A'}</td></tr>
                            <tr><td>Biofuels</td><td>${sc.biofuels ? 'Yes' : 'No'}</td><td>${sc.biofuels_remarks || 'N/A'}</td></tr>
                            <tr><td>Consumer Safety</td><td>${sc.consume_safety ? 'Yes' : 'No'}</td><td>${sc.consume_safety_remarks || 'N/A'}</td></tr>
                            <tr><td>CEL Warning</td><td>${sc.cel_warn ? 'Yes' : 'No'}</td><td>${sc.cel_warn_remarks || 'N/A'}</td></tr>
                            <tr><td>No Smoking Sign</td><td>${sc.smoke_sign ? 'Yes' : 'No'}</td><td>${sc.smoke_sign_remarks || 'N/A'}</td></tr>
                            <tr><td>Switch Off Engine</td><td>${sc.switch_eng ? 'Yes' : 'No'}</td><td>${sc.switch_eng_remarks || 'N/A'}</td></tr>
                            <tr><td>Straddle</td><td>${sc.straddle ? 'Yes' : 'No'}</td><td>${sc.straddle_remarks || 'N/A'}</td></tr>
                            <tr><td>Post Unleaded</td><td>${sc.post_unleaded ? 'Yes' : 'No'}</td><td>${sc.post_unleaded_remarks || 'N/A'}</td></tr>
                            <tr><td>Post Biodiesel</td><td>${sc.post_biodiesel ? 'Yes' : 'No'}</td><td>${sc.post_biodiesel_remarks || 'N/A'}</td></tr>
                            <tr><td>Issue Receipt</td><td>${sc.issue_receipt ? 'Yes' : 'No'}</td><td>${sc.issue_receipt_remarks || 'N/A'}</td></tr>
                            <tr><td>Non-Refuse Inspection</td><td>${sc.non_refuse_inspect ? 'Yes' : 'No'}</td><td>${sc.non_refuse_inspect_remarks || 'N/A'}</td></tr>
                            <tr><td>Non-Refuse Sign</td><td>${sc.non_refuse_sign ? 'Yes' : 'No'}</td><td>${sc.non_refuse_sign_remarks || 'N/A'}</td></tr>
                            <tr><td>Fixed Dispense</td><td>${sc.fixed_dispense ? 'Yes' : 'No'}</td><td>${sc.fixed_dispense_remarks || 'N/A'}</td></tr>
                            <tr><td>No Open Flame</td><td>${sc.no_open_flame ? 'Yes' : 'No'}</td><td>${sc.no_open_flame_remarks || 'N/A'}</td></tr>
                            <tr><td>Max Length Dispense</td><td>${sc.max_length_dispense ? 'Yes' : 'No'}</td><td>${sc.max_length_dispense_remarks || 'N/A'}</td></tr>
                            <tr><td>Peso Display</td><td>${sc.peso_display ? 'Yes' : 'No'}</td><td>${sc.peso_display_remarks || 'N/A'}</td></tr>
                            <tr><td>Pump Island</td><td>${sc.pump_island ? 'Yes' : 'No'}</td><td>${sc.pump_island_remarks || 'N/A'}</td></tr>
                            <tr><td>Lane Oriented Pump</td><td>${sc.lane_oriented_pump ? 'Yes' : 'No'}</td><td>${sc.lane_oriented_pump_remarks || 'N/A'}</td></tr>
                            <tr><td>Pump Guard</td><td>${sc.pump_guard ? 'Yes' : 'No'}</td><td>${sc.pump_guard_remarks || 'N/A'}</td></tr>
                            <tr><td>Ingress</td><td>${sc.m_ingress ? 'Yes' : 'No'}</td><td>${sc.m_ingress_remarks || 'N/A'}</td></tr>
                            <tr><td>Edge</td><td>${sc.m_edge ? 'Yes' : 'No'}</td><td>${sc.m_edge_remarks || 'N/A'}</td></tr>
                            <tr><td>Office/Cashier</td><td>${sc.office_cashier ? 'Yes' : 'No'}</td><td>${sc.office_cashier_remarks || 'N/A'}</td></tr>
                            <tr><td>Minimum Canopy</td><td>${sc.min_canopy ? 'Yes' : 'No'}</td><td>${sc.min_canopy_remarks || 'N/A'}</td></tr>
                            <tr><td>Boundary Walls</td><td>${sc.boundary_walls ? 'Yes' : 'No'}</td><td>${sc.boundary_walls_remarks || 'N/A'}</td></tr>
                            <tr><td>Master Switch</td><td>${sc.master_switch ? 'Yes' : 'No'}</td><td>${sc.master_switch_remarks || 'N/A'}</td></tr>
                            <tr><td>Clean Restroom</td><td>${sc.clean_rest ? 'Yes' : 'No'}</td><td>${sc.clean_rest_remarks || 'N/A'}</td></tr>
                            <tr><td>Underground Storage</td><td>${sc.underground_storage ? 'Yes' : 'No'}</td><td>${sc.underground_storage_remarks || 'N/A'}</td></tr>
                            <tr><td>Minimum Distance</td><td>${sc.m_distance ? 'Yes' : 'No'}</td><td>${sc.m_distance_remarks || 'N/A'}</td></tr>
                            <tr><td>Vent</td><td>${sc.vent ? 'Yes' : 'No'}</td><td>${sc.vent_remarks || 'N/A'}</td></tr>
                            <tr><td>Transfer Dispense</td><td>${sc.transfer_dispense ? 'Yes' : 'No'}</td><td>${sc.transfer_dispense_remarks || 'N/A'}</td></tr>
                            <tr><td>No Drum</td><td>${sc.no_drum ? 'Yes' : 'No'}</td><td>${sc.no_drum_remarks || 'N/A'}</td></tr>
                            <tr><td>No Hoard</td><td>${sc.no_hoard ? 'Yes' : 'No'}</td><td>${sc.no_hoard_remarks || 'N/A'}</td></tr>
                            <tr><td>Free Tire Pressure</td><td>${sc.free_tire_press ? 'Yes' : 'No'}</td><td>${sc.free_tire_press_remarks || 'N/A'}</td></tr>
                            <tr><td>Free Water</td><td>${sc.free_water ? 'Yes' : 'No'}</td><td>${sc.free_water_remarks || 'N/A'}</td></tr>
                            <tr><td>Basic Mechanical</td><td>${sc.basic_mechanical ? 'Yes' : 'No'}</td><td>${sc.basic_mechanical_remarks || 'N/A'}</td></tr>
                            <tr><td>First Aid</td><td>${sc.first_aid ? 'Yes' : 'No'}</td><td>${sc.first_aid_remarks || 'N/A'}</td></tr>
                            <tr><td>Design Evaluation</td><td>${sc.design_eval ? 'Yes' : 'No'}</td><td>${sc.design_eval_remarks || 'N/A'}</td></tr>
                            <tr><td>Electric Evaluation</td><td>${sc.electric_eval ? 'Yes' : 'No'}</td><td>${sc.electric_eval_remarks || 'N/A'}</td></tr>
                            <tr><td>Under Deliver</td><td>${sc.under_deliver ? 'Yes' : 'No'}</td><td>${sc.under_deliver_remarks || 'N/A'}</td></tr>
                        `;
                    } else {
                        content += `<tr><td colspan="3">No standard compliance data found</td></tr>`;
                    }
                    
                    content += `</tbody></table></div>
                            
                            <h6 class="mt-3">Suppliers</h6>
                            <table class="details-table table table-sm table-bordered">
                                <thead>
                                    <tr>
                                        <th>Supplier</th>
                                        <th>Receipt/Invoice</th>
                                        <th>Date Delivered</th>
                                        <th>Address</th>
                                        <th>Contact Number</th>
                                    </tr>
                                </thead>
                                <tbody>`;
                    
                    if (response.suppliersInfo && response.suppliersInfo.length > 0) {
                        response.suppliersInfo.forEach(supplier => {
                            content += `
                                <tr>
                                    <td>${supplier.supplier || 'N/A'}</td>
                                    <td>${supplier.receipt_invoice || 'N/A'}</td>
                                    <td>${supplier.date_deliver || 'N/A'}</td>
                                    <td>${supplier.address || 'N/A'}</td>
                                    <td>${supplier.contact_num || 'N/A'}</td>
                                </tr>`;
                        });
                    } else {
                        content += `<tr><td colspan="5">No supplier data found</td></tr>`;
                    }
                    
                    content += `</tbody></table>
                            
                            <h6 class="mt-3">Summary Remarks</h6>
                            <table class="details-table table table-sm table-bordered">
                                <thead>
                                    <tr>
                                        <th>Extracted Violations</th>
                                        <th>Extracted General Remarks</th>
                                        <th>User Violations</th>
                                        <th>User General Remarks</th>
                                        <th>Action Required</th>
                                    </tr>
                                </thead>
                                <tbody>`;
                    
                    if (response.summaryRemarks && response.summaryRemarks.length > 0) {
                        const summary = response.summaryRemarks[0];
                        content += `
                            <tr>
                                <td>${summary.extracted_violations || 'N/A'}</td>
                                <td>${summary.extracted_gen_remarks || 'N/A'}</td>
                                <td>${summary.user_violations || 'N/A'}</td>
                                <td>${summary.user_gen_remarks || 'N/A'}</td>
                                <td>${summary.action_required || 'N/A'}</td>
                            </tr>`;
                    } else {
                        content += `<tr><td colspan="5">No summary remarks found</td></tr>`;
                    }
                    
                    content += `</tbody></table>
                        </div>
                    `;
                    
                    // Update the child row with the actual content
                    row.child().find('.details-container').html(content);
                },
                error: function(xhr, status, error) {
                    row.child().find('.details-container').html(`
                        <div class="alert alert-danger">
                            Error loading related data: ${error}
                        </div>
                    `);
                }
            });
        }

        // Handle view button click
        $('#businessTable').on('click', '.view-btn', function() {
            let itrFormNum = $(this).data('id');
            viewBusiness(itrFormNum);
        });

        // Handle edit button click
        $('#businessTable').on('click', '.edit-btn', function() {
            let itrFormNum = $(this).data('id');
            editBusiness(itrFormNum);
        });

        // Handle delete button click
        $('#businessTable').on('click', '.delete-btn', function() {
            let itrFormNum = $(this).data('id');
            $('#deleteModal').data('id', itrFormNum).modal('show');
        });

        // Confirm delete
        $('#confirmDelete').click(function() {
            let itrFormNum = $('#deleteModal').data('id');
            deleteBusiness(itrFormNum);
        });

        // Save business data
        $('#saveBusiness').click(function() {
            saveBusiness();
        });


        
        // Function to view business details
        function viewBusiness(itrFormNum) {
    $.ajax({
        url: 'fetch_business_details.php',
        method: 'POST',
        data: { itr_form_num: itrFormNum },
        dataType: 'json',
        success: function(response) {
            // Populate the form first
            populateForm(response);
            
            // Disable all form fields
            $('#businessForm :input').prop('disabled', true);
            $('#businessTabs .nav-link').prop('disabled', false);
            
            // Change modal title and show
            $('#businessModalLabel').text('View Business Details: ' + itrFormNum);
            $('#saveBusiness').hide();
            
            // Show modal first, then activate tab
            $('#businessModal').modal('show').on('shown.bs.modal', function() {
                if (!$('#basic-tab').hasClass('active')) {
                    $('#basic-tab').tab('show');
                }
            });
        },
        error: function(xhr, status, error) {
            alert('Error loading business details: ' + error);
        }
    });
}


        // Function to edit business details
        function editBusiness(itrFormNum) {
            $.ajax({
                url: 'fetch_business_details.php',
                method: 'POST',
                data: { itr_form_num: itrFormNum },
                dataType: 'json',
                success: function(response) {
                    console.log(response)
                    // Populate the form
                    populateForm(response);
                    
                    // Enable all form fields
                    $('#businessForm :input').prop('disabled', false);
                    
                    // Change modal title and show
                    $('#businessModalLabel').text('Edit Business Details : ' + itrFormNum);
                    $('#saveBusiness').show();
                    $('#businessModal').modal('show');
                },
                error: function(xhr, status, error) {
                    alert('Error loading business details: ' + error);
                }
            });
        }

        // Function to populate form with data------------------------------------------------------------....>>>
        function populateForm(data) {
            // Basic business info
            $('#itr_form_num').val(data.businessInfo.itr_form_num);
            $('#business_name').val(data.businessInfo.business_name);
            $('#dealer_operator').val(data.businessInfo.dealer_operator);
            $('#location').val(data.businessInfo.location);
            $('#in_charge').val(data.businessInfo.in_charge);
            $('#designation').val(data.businessInfo.designation);
            $('#outlet_class').val(data.businessInfo.outlet_class);
            $('#company').val(data.businessInfo.company);
            $('#contact_tel').val(data.businessInfo.contact_tel);
            $('#email_add').val(data.businessInfo.email_add);
            $('#sampling').prop('checked', data.businessInfo.sampling);
            $('#inspector_name').val(data.businessInfo.inspector_name);
            $('#sa_no').val(data.businessInfo.sa_no);
            $('#sa_date').val(data.businessInfo.sa_date ? data.businessInfo.sa_date.split(' ')[0] : '');
            
// General remarks
if (data.generalRemarks && data.generalRemarks.length > 0) {
    // Join all remarks with line breaks
    const allRemarks = data.generalRemarks
        .filter(remark => remark.remarks) // Filter out empty/null remarks
        .map(remark => remark.remarks)
        .join('\n');
    
    $('#remarks').val(allRemarks);
}
            
            // Product quality
       // Product quality - handling multiple entries
if (data.productQuality && data.productQuality.length > 0) {
    // Clear existing product entries (if any)
    $('#productQualityContainer').empty();
    
    // Create a card for each product entry
    data.productQuality.forEach((product, index) => {
        // Create a new product entry div
        const productEntry = `
        <div class="product-entry card mb-3" data-index="${index}">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="mb-0">Product Entry #${index + 1}</h6>
                <button type="button" class="btn btn-sm btn-danger remove-product-btn">
                    Remove
                </button>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label class="form-label">Product</label>
                        <input type="text" class="form-control" name="products[${index}][product]" 
                               value="${product.product || ''}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">RON Value</label>
                        <input type="text" class="form-control" name="products[${index}][ron_value]" 
                               value="${product.ron_value || ''}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">UGT</label>
                        <input type="text" class="form-control" name="products[${index}][UGT]" 
                               value="${product.UGT || ''}">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Pump</label>
                        <input type="text" class="form-control" name="products[${index}][pump]" 
                               value="${product.pump || ''}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Code Value</label>
                        <input type="text" class="form-control" name="products[${index}][code_value]" 
                               value="${product.code_value || ''}">
                    </div>
                </div>
            </div>
        </div>
        `;
        
        $('#productQualityContainer').append(productEntry);
    });
} else {
    // If no products exist, add one empty entry
    addNewProductEntry();
}

// Function to add a new empty product entry
function addNewProductEntry() {
    const index = $('#productQualityContainer .product-entry').length;
    const emptyEntry = `
    <div class="product-entry card mb-3" data-index="${index}">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="mb-0">Product Entry #${index + 1}</h6>
            <button type="button" class="btn btn-sm btn-danger remove-product-btn">
                Remove
            </button>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-4">
                    <label class="form-label">Product</label>
                    <input type="text" class="form-control" name="products[${index}][product]">
                </div>
                <div class="col-md-4">
                    <label class="form-label">RON Value</label>
                    <input type="text" class="form-control" name="products[${index}][ron_value]">
                </div>
                <div class="col-md-4">
                    <label class="form-label">UGT</label>
                    <input type="text" class="form-control" name="products[${index}][UGT]">
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Pump</label>
                    <input type="text" class="form-control" name="products[${index}][pump]">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Code Value</label>
                    <input type="text" class="form-control" name="products[${index}][code_value]">
                </div>
            </div>
        </div>
    </div>
    `;
    
    $('#productQualityContainer').append(emptyEntry);
}

// Handle remove button clicks
$(document).on('click', '.remove-product-btn', function() {
    $(this).closest('.product-entry').remove();
    // Re-index remaining entries
    $('#productQualityContainer .product-entry').each(function(index) {
        $(this).attr('data-index', index);
        $(this).find('.card-header h6').text(`Product Entry #${index + 1}`);
        $(this).find('input').each(function() {
            const name = $(this).attr('name').replace(/\[\d+\]/, `[${index}]`);
            $(this).attr('name', name);
        });
    });
});

// Add button to add new product entries
$('#add-product-btn').click(function() {
    addNewProductEntry();
});
            
            // Product quality control
            if (data.productQualityCont && data.productQualityCont.length > 0) {
                const pqc = data.productQualityCont[0];
                $('#duplicate_retention_samples').prop('checked', pqc.duplicate_retention_samples);
                $('#retention_retail').prop('checked', pqc.retention_retail);
                $('#appropriate_sampling').prop('checked', pqc.appropriate_sampling);
                $('#inappropriate_sampling').prop('checked', pqc.inappropriate_sampling);
            }
            
            // Standard compliance
            if (data.standardCompliance && data.standardCompliance.length > 0) {
                const sc = data.standardCompliance[0];
                console.log(sc);
                $('#coc_cert').prop('checked', sc.coc_cert);
                $('#coc_cert_remarks').val(sc.coc_cert_remarks);
                $('#coc_posted').prop('checked', sc.coc_posted);
                $('#coc_posted_remarks').val(sc.coc_posted_remarks);
                $('#valid_permit_LGU').prop('checked', sc.valid_permit_LGU);
                $('#valid_permit_LGU_remarks').val(sc.valid_permit_LGU_remarks);
                $('#valid_permit_BFP').prop('checked', sc.valid_permit_BFP);
                $('#valid_permit_BFP_remarks').val(sc.valid_permit_BFP_remarks);
                $('#valid_permit_DENR').prop('checked', sc.valid_permit_DENR);
                $('#valid_permit_DENR_remarks').val(sc.valid_permit_DENR_remarks);
                $('#appropriate_test').prop('checked', sc.appropriate_test);
                $('#appropriate_test_remarks').val(sc.appropriate_test_remarks);
                $('#week_calib').prop('checked', sc.week_calib);
                $('#week_calib_remarks').val(sc.week_calib_remarks);
                $('#outlet_identify').prop('checked', sc.outlet_identify);
                $('#outlet_identify_remarks').val(sc.outlet_identify_remarks);
                $('#price_display').prop('checked', sc.price_display);
                $('#price_display_remarks').val(sc.price_display_remarks);
                $('#pdb_entry').prop('checked', sc.pdb_entry);
                $('#pdb_entry_remarks').val(sc.pdb_entry_remarks);
                $('#pdb_updated').prop('checked', sc.pdb_updated);
                $('#pdb_updated_remarks').val(sc.pdb_updated_remarks);
                $('#pdb_match').prop('checked', sc.pdb_match);
                $('#pdb_match_remarks').val(sc.pdb_match_remarks);
                $('#ron_label').prop('checked', sc.ron_label);
                $('#ron_label_remarks').val(sc.ron_label_remarks);
                $('#e10_label').prop('checked', sc.e10_label);
                $('#e10_label_remarks').val(sc.e10_label_remarks);
                $('#biofuels').prop('checked', sc.biofuels);
                $('#biofuels_remarks').val(sc.biofuels_remarks);
                $('#consume_safety').prop('checked', sc.consume_safety);
                $('#consume_safety_remarks').val(sc.consume_safety_remarks);
                $('#cel_warn').prop('checked', sc.cel_warn);
                $('#cel_warn_remarks').val(sc.cel_warn_remarks);
                $('#smoke_sign').prop('checked', sc.smoke_sign);
                $('#smoke_sign_remarks').val(sc.smoke_sign_remarks);
                $('#switch_eng').prop('checked', sc.switch_eng);
                $('#switch_eng_remarks').val(sc.switch_eng_remarks);
                $('#straddle').prop('checked', sc.straddle);
                $('#straddle_remarks').val(sc.straddle_remarks);
                $('#post_unleaded').prop('checked', sc.post_unleaded);
                $('#post_unleaded_remarks').val(sc.post_unleaded_remarks);
                $('#post_biodiesel').prop('checked', sc.post_biodiesel);
                $('#post_biodiesel_remarks').val(sc.post_biodiesel_remarks);
                $('#issue_receipt').prop('checked', sc.issue_receipt);
                $('#issue_receipt_remarks').val(sc.issue_receipt_remarks);
                $('#non_refuse_inspect').prop('checked', sc.non_refuse_inspect);
                $('#non_refuse_inspect_remarks').val(sc.non_refuse_inspect_remarks);
                $('#non_refuse_sign').prop('checked', sc.non_refuse_sign);
                $('#non_refuse_sign_remarks').val(sc.non_refuse_sign_remarks);
                $('#fixed_dispense').prop('checked', sc.fixed_dispense);
                $('#fixed_dispense_remarks').val(sc.fixed_dispense_remarks);
                $('#no_open_flame').prop('checked', sc.no_open_flame);
                $('#no_open_flame_remarks').val(sc.no_open_flame_remarks);
                $('#max_length_dispense').prop('checked', sc.max_length_dispense);
                $('#max_length_dispense_remarks').val(sc.max_length_dispense_remarks);
                $('#peso_display').val(sc.peso_display);
                $('#peso_display_remarks').val(sc.peso_display_remarks);
                $('#pump_island').prop('checked', sc.pump_island);
                $('#pump_island_remarks').val(sc.pump_island_remarks);
                $('#lane_oriented_pump').prop('checked', sc.lane_oriented_pump);
                $('#lane_oriented_pump_remarks').val(sc.lane_oriented_pump_remarks);
                $('#pump_guard').prop('checked', sc.pump_guard);
                $('#pump_guard_remarks').val(sc.pump_guard_remarks);
                $('#m_ingress').prop('checked', sc.m_ingress);
                $('#m_ingress_remarks').val(sc.m_ingress_remarks);
                $('#m_edge').prop('checked', sc.m_edge);
                $('#m_edge_remarks').val(sc.m_edge_remarks);
                $('#office_cashier').prop('checked', sc.office_cashier);
                $('#office_cashier_remarks').val(sc.office_cashier_remarks);
                $('#min_canopy').prop('checked', sc.min_canopy);
                $('#min_canopy_remarks').val(sc.min_canopy_remarks);
                $('#boundary_walls').prop('checked', sc.boundary_walls);
                $('#boundary_walls_remarks').val(sc.boundary_walls_remarks);
                $('#master_switch').prop('checked', sc.master_switch);
                $('#master_switch_remarks').val(sc.master_switch_remarks);
                $('#clean_rest').prop('checked', sc.clean_rest);
                $('#clean_rest_remarks').val(sc.clean_rest_remarks);
                $('#underground_storage').prop('checked', sc.underground_storage);
                $('#underground_storage_remarks').val(sc.underground_storage_remarks);
                $('#m_distance').prop('checked', sc.m_distance);
                $('#m_distance_remarks').val(sc.m_distance_remarks);
                $('#vent').prop('checked', sc.vent);
                $('#vent_remarks').val(sc.vent_remarks);
                $('#transfer_dispense').prop('checked', sc.transfer_dispense);
                $('#transfer_dispense_remarks').val(sc.transfer_dispense_remarks);
                $('#no_drum').prop('checked', sc.no_drum);
                $('#no_drum_remarks').val(sc.no_drum_remarks);
                $('#no_hoard').prop('checked', sc.no_hoard);
                $('#no_hoard_remarks').val(sc.no_hoard_remarks);
                $('#free_tire_press').prop('checked', sc.free_tire_press);
                $('#free_tire_press_remarks').val(sc.free_tire_press_remarks);
                $('#free_water').prop('checked', sc.free_water);
                $('#free_water_remarks').val(sc.free_water_remarks);
                $('#basic_mechanical').prop('checked', sc.basic_mechanical);
                $('#basic_mechanical_remarks').val(sc.basic_mechanical_remarks);
                $('#first_aid').prop('checked', sc.first_aid);
                $('#first_aid_remarks').val(sc.first_aid_remarks);
                $('#design_eval').prop('checked', sc.design_eval);
                $('#design_eval_remarks').val(sc.design_eval_remarks);
                $('#electric_eval').prop('checked', sc.electric_eval);
                $('#electric_eval_remarks').val(sc.electric_eval_remarks);
                $('#under_deliver').prop('checked', sc.under_deliver);
                $('#under_deliver_remarks').val(sc.under_deliver_remarks);
            }
            
            // Suppliers info
            if (data.suppliersInfo && data.suppliersInfo.length > 0) {
                const si = data.suppliersInfo[0];
                $('#supplier').val(si.supplier);
                $('#receipt_invoice').val(si.receipt_invoice);
                $('#date_deliver').val(si.date_deliver.split(' ')[0]);
                $('#address').val(si.address);
                $('#contact_num').val(si.contact_num);
            }
            // Summary remarks
// Summary remarks
if (data.summaryRemarks && data.summaryRemarks.length > 0) {
    const sr = data.summaryRemarks[0]; // Assuming it's an array

    // Parse JSON strings into arrays
    const extractedViolations = JSON.parse(sr.extracted_violations || '[]');
    const extractedGenRemarks = JSON.parse(sr.extracted_gen_remarks || '[]');
    const userViolations = JSON.parse(sr.user_violations || '[]');
    const userGenRemarks = JSON.parse(sr.user_gen_remarks || '[]');

    // Populate the fields
    $('#extracted_violations').val(extractedViolations.join('\n'));
    $('#extracted_gen_remarks').val(extractedGenRemarks.join('\n'));
    $('#user_violations').val(userViolations.join('\n'));
    $('#user_gen_remarks').val(userGenRemarks.join('\n'));
    $('#action_required').val(sr.action_required || '');
} else {
    // Clear the fields if no data is found
    $('#extracted_violations').val('');
    $('#extracted_gen_remarks').val('');
    $('#user_violations').val('');
    $('#user_gen_remarks').val('');
    $('#action_required').val('');
}
        }

        // Function to save business data
        function saveBusiness() {
            // Collect form data
            let formData = $('#businessForm').serializeArray();
            let data = {};
            
            $(formData).each(function(index, obj){
                data[obj.name] = obj.value;
            });
            
            // Add checkbox values
            data['sampling'] = $('#sampling').is(':checked') ? 1 : 0;
            
            // Product quality control
            data['duplicate_retention_samples'] = $('#duplicate_retention_samples').is(':checked') ? 1 : 0;
            data['retention_retail'] = $('#retention_retail').is(':checked') ? 1 : 0;
            data['appropriate_sampling'] = $('#appropriate_sampling').is(':checked') ? 1 : 0;
            data['inappropriate_sampling'] = $('#inappropriate_sampling').is(':checked') ? 1 : 0;
            
            // Standard compliance checklist
            data['coc_cert'] = $('#coc_cert').is(':checked') ? 1 : 0;
            data['coc_posted'] = $('#coc_posted').is(':checked') ? 1 : 0;
            data['valid_permit_LGU'] = $('#valid_permit_LGU').is(':checked') ? 1 : 0;
            data['valid_permit_BFP'] = $('#valid_permit_BFP').is(':checked') ? 1 : 0;
            data['valid_permit_DENR'] = $('#valid_permit_DENR').is(':checked') ? 1 : 0;
            data['appropriate_test'] = $('#appropriate_test').is(':checked') ? 1 : 0;
            data['week_calib'] = $('#week_calib').is(':checked') ? 1 : 0;
            data['outlet_identify'] = $('#outlet_identify').is(':checked') ? 1 : 0;
            data['price_display'] = $('#price_display').is(':checked') ? 1 : 0;
            data['pdb_entry'] = $('#pdb_entry').is(':checked') ? 1 : 0;
            data['pdb_updated'] = $('#pdb_updated').is(':checked') ? 1 : 0;
            data['pdb_match'] = $('#pdb_match').is(':checked') ? 1 : 0;
            data['ron_label'] = $('#ron_label').is(':checked') ? 1 : 0;
            data['e10_label'] = $('#e10_label').is(':checked') ? 1 : 0;
            data['biofuels'] = $('#biofuels').is(':checked') ? 1 : 0;
            data['consume_safety'] = $('#consume_safety').is(':checked') ? 1 : 0;
            data['cel_warn'] = $('#cel_warn').is(':checked') ? 1 : 0;
            data['smoke_sign'] = $('#smoke_sign').is(':checked') ? 1 : 0;
            data['switch_eng'] = $('#switch_eng').is(':checked') ? 1 : 0;
            data['straddle'] = $('#straddle').is(':checked') ? 1 : 0;
            data['post_unleaded'] = $('#post_unleaded').is(':checked') ? 1 : 0;
            data['post_biodiesel'] = $('#post_biodiesel').is(':checked') ? 1 : 0;
            data['issue_receipt'] = $('#issue_receipt').is(':checked') ? 1 : 0;
            data['non_refuse_inspect'] = $('#non_refuse_inspect').is(':checked') ? 1 : 0;
            data['non_refuse_sign'] = $('#non_refuse_sign').is(':checked') ? 1 : 0;
            data['fixed_dispense'] = $('#fixed_dispense').is(':checked') ? 1 : 0;
            data['no_open_flame'] = $('#no_open_flame').is(':checked') ? 1 : 0;
            data['max_length_dispense'] = $('#max_length_dispense').is(':checked') ? 1 : 0;
            data['pump_island'] = $('#pump_island').is(':checked') ? 1 : 0;
            data['lane_oriented_pump'] = $('#lane_oriented_pump').is(':checked') ? 1 : 0;
            data['pump_guard'] = $('#pump_guard').is(':checked') ? 1 : 0;
            data['m_ingress'] = $('#m_ingress').is(':checked') ? 1 : 0;
            data['m_edge'] = $('#m_edge').is(':checked') ? 1 : 0;
            data['office_cashier'] = $('#office_cashier').is(':checked') ? 1 : 0;
            data['min_canopy'] = $('#min_canopy').is(':checked') ? 1 : 0;
            data['boundary_walls'] = $('#boundary_walls').is(':checked') ? 1 : 0;
            data['master_switch'] = $('#master_switch').is(':checked') ? 1 : 0;
            data['clean_rest'] = $('#clean_rest').is(':checked') ? 1 : 0;
            data['underground_storage'] = $('#underground_storage').is(':checked') ? 1 : 0;
            data['m_distance'] = $('#m_distance').is(':checked') ? 1 : 0;
            data['vent'] = $('#vent').is(':checked') ? 1 : 0;
            data['transfer_dispense'] = $('#transfer_dispense').is(':checked') ? 1 : 0;
            data['no_drum'] = $('#no_drum').is(':checked') ? 1 : 0;
            data['no_hoard'] = $('#no_hoard').is(':checked') ? 1 : 0;
            data['free_tire_press'] = $('#free_tire_press').is(':checked') ? 1 : 0;
            data['free_water'] = $('#free_water').is(':checked') ? 1 : 0;
            data['basic_mechanical'] = $('#basic_mechanical').is(':checked') ? 1 : 0;
            data['first_aid'] = $('#first_aid').is(':checked') ? 1 : 0;
            data['design_eval'] = $('#design_eval').is(':checked') ? 1 : 0;
            data['electric_eval'] = $('#electric_eval').is(':checked') ? 1 : 0;
            data['under_deliver'] = $('#under_deliver').is(':checked') ? 1 : 0;
            
            // Send data to server
            $.ajax({
                url: 'save_business.php',
                method: 'POST',
                data: data,
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Success',
                            text: 'Business data saved successfully'
                        });
                        $('#modal-content').modal('hide');
                        table.ajax.reload();
                    } else {
                        wal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Error saving business data: ' + response.message
                        });
                    }
                },
                error: function(xhr, status, error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Error saving business data: ' + error
                    });
                }
            });
        }

        // Function to delete business
        function deleteBusiness(itrFormNum) {
            $.ajax({
                url: 'delete_business.php',
                method: 'POST',
                data: { itr_form_num: itrFormNum },
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Deleted',
                            text: 'Business deleted successfully'
                        });
                        $('#deleteModal').modal('hide');
                        table.ajax.reload();
                     
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Error deleting business: ' + response.message
                        });
                    }
                },
                error: function(xhr, status, error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Error deleting business: ' + error
                    });
                }
            });
        }
    });
    </script>









</body>
</html>